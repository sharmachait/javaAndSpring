first line of defense - controlling access to the api server

we can control who can have access with
1. username and passwords
2. username and tokens
3. certificates
4. external auth providers
5. service accounts
we can control what access a user has with
1. RBAC
2. ABAC
3. Node based authorization
4. webhook mode
all communication between the internal modules of k8s is TLS encrypted

Bots and automation agents can be authorized with service accounts
Users (admins/developers) can be authorized at the kube api server level using
1. static passwords file, CSV, we can save the data in a CSV file 
2. static token file, CSV
3. certificates
4. third party auth providers

### authentication setup
if we save the users and passwords in a CSV file we have it define it in the options for the **kube-apiserver.service** and restart the the server
or we can modify the kube-apiserver pod manifest file and add it as an option to the command
**--basic-auth-file=user-details.csv**
these must be passed as basic credentials using curl to hit kubernetes api
the user-details.csv file has password user name the id and groups
```csv
password123,user1,u0001,group1
password123,user12,u0002,group1
```
everything is same for the static token file just instead of password it stores the token and can be passed in with
**--token-auth-file=user-token.details.csv**
this token needs to be passed in the Authorization header as a Bearer token when communicating with the kube-api-server

obviously these are not recommended approaches
### authenticating with certificates
we can provide options for the cert in kubectl commands to authenticate our api requests
> kubectl get pods --server kube-cert-server:6443 --client-key admin.key --client-certificate admin.crt --certificate-authority ca.crt
### kube config

the certificate options and infromation in the above command can be instead written into a kube-config file that will be used for each command
**$HOME/.kube/config**

the kube config file has information about clusters contexts and user accounts

we can switch between different clusters and different user accounts and different contexts

contexts are used to form join relationships between clusters and user accounts

we never explicitly switch clusters, we switch contexts

a context => cluster + user-account

the server information is stored in the clusters section
the user keys and certs are stored in the users section of the kube config

```yml
apiVersion: v1
kind: Config
current-context: dev-admin@devcluster
clusters:
- name: dev-cluster
  cluster: 
    certificate-authority: caq.cert
    server: https://dev-cluster:6443
contexts:
- name: dev-admin@dev-cluster
  context:
    cluster: dev-cluster
    user: dev-admin
users:
- name: dev-admin
  user:
    client-certificate: admin.crt
    client-key: admin.key
```

the current context is used as the context by default

we can view the config with
>kubectl config view

we cna change which config file should be used by kubectl with
>kubectl config view --kubeconfig=custom-config

to change the context
>kubectl config use-context prod-user@production

this will update the kube-config  file to reflect the currently selected context